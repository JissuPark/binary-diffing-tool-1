import os
import json
from pprint import pprint

def read_json(PATH):
    with open(PATH, "r", encoding="UTF-8") as json_file:
        json_data = json.load(json_file)
    return json_data

if __name__ == "__main__":

    BASE = "C:\\Users\\E-2\\Desktop\\malware hash Set\\"
    result = "C:\\Users\\E-2\\Desktop\\result\\"

    whiteList = read_json(r"C:\Users\E-2\Desktop\whitelist_bbhs.py")
    # for hash in whiteList:
    #     pass

    for _dir in os.listdir(BASE):
        full_path = BASE + _dir + '\\' + os.listdir(BASE + _dir)[0]
        temper_dic = dict()
        mal_hash_set = read_json(full_path)
        for mal_hash in mal_hash_set:
            if mal_hash in whiteList:
                pass
            else:
                temper_dic.update({mal_hash:mal_hash_set[mal_hash]})

        if not os.path.isdir(result + _dir):
	        os.mkdir(result + _dir)
            
        with open(result + _dir + '\\' + _dir +".hashSet", 'w') as makefile:
            json.dump(temper_dic, makefile, ensure_ascii=False, indent='\t')

        #print(f"[Debug] {_dir} malware HashSet ::: {len(mal_hash_set)} - {len(temper_dic)} = matched( {len(mal_hash_set) - len(temper_dic)} ) [{round((len(mal_hash_set) + len(temper_dic)) / (len(mal_hash_set) - len(temper_dic)), 2)}%] ")
        del temper_dic, mal_hash_set