{% extends "Main_engine/layout.html" %}

{% block title %} CFG page {% endblock %}
{% block head %}
<script src="//d3js.org/d3.v4.min.js"></script>
<script src="https://unpkg.com/viz.js@1.8.1/viz.js" type="javascript/worker"></script>
<script src="https://unpkg.com/d3-graphviz@2.6.1/build/d3-graphviz.js"></script>
{% endblock head %}

{% block section %}
<div class="mt-5" id="graph" style="text-align: center;"></div>
{% if cfg_ %}
<script>
    var cfgdata = "{{cfg_}}";
    // document.write(cfgdata)
    var text_res = cfgdata.replace(/&#39;/gi, '"').replace(/\n/gi, '\\n').replace(/\r/gi, '\\r').replace(/\t/gi, '\\t');
    // document.write(text_res);
    var json_res = JSON.parse(text_res);

    document.write('<br>');
    var array = [];
    for (var startaddr in json_res){
        if(startaddr != "flow_opString" && startaddr != "flow_constants") {
            // document.write(startaddr+"<br>");
            var block = startaddr + '\n' + json_res[startaddr]['disasms'];
            // asdf = asdf.replace(/'<br>'/gi, '&#39;');
            // document.write(block);
            // document.write('<br>');
            array.push(block);
            // block = 'graph { node [shape=box] '+ block+ '}';
            // d3.select("#graph").graphviz()
            //     .fade(false)
            //     .renderDot(block);
            // document.write(block);
        }
    }
    document.write('<br>');
    // document.write(array[0]);

    var box = 'graph { node [shape=box] ';
    for (var item in array){
        box = item + ' [label="' + array[item] + '"];\n';
    }
    box = box + '}';
    d3.select("#graph").graphviz()
        .fade(false)
        .renderDot(box);

    var a = '"push\tebp\n"' + "asdf";
    var b = '"pop\\tedi\n",' +
        '"pop\\tesi\r",' +
        '"ret\\t"';
    var str = 'digraph Orthogonal{' +
        'node [shape=box]' +
        a + '->' + b + '}';

    // d3.select("#graph").graphviz()
    //     .fade(false)
    //     .renderDot(str);

</script>
{% else %}
<h2>Nope!</h2>
{% endif %}
{% endblock section %}