{% extends "Main_engine/layout.html" %}

{% block head %}
{% load static %}
<link href="{% static 'Main_engine/css/pe.css' %}" rel="stylesheet">
<link href="{% static 'Main_engine/css/style.css' %}" rel="stylesheet">
{% endblock head %}

{% block section %}
{% if lists.has_other_pages %}
<!--<nav aria-label="..." style="padding: 10px">-->
    <div id="page" style="position: relative; left: 500px; top: 20px;">
        <ul class="pagination">
            {% if lists.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ lists.previous_page_number }}">Previous</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">Previous</span>
            </li>
            {% endif %}
            {% for i in lists.paginator.page_range %}
            {% if lists.number == i %}
            <li aria-current="page" class="page-item active">
                <span class="page-link">{{ i }}<span class="sr-only">(current)</span></span></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
            {% endfor %}
            {% if lists.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ lists.next_page_number }}">Next</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link">Next</a>
            </li>
            {% endif %}
        </ul>
    </div>
<!--</nav>-->
{% endif %}
<br><br><br>

<div id="wrapper" style="padding: 10px">
    <div class="header">
        <h3 align="left">Basic Properties</h3>
    </div>
    <div class="detail" style="margin-left: 20px;">
        {% for pe in lists %}
        <table height=300px width=1000px>
            <tr>
                <th>File name</th>
                <td>{{pe.filename}}</td>
            </tr>
            <tr>
                <th>File size</th>
                <td>{{pe.filesize}}</td>
            </tr>
            <tr>
                <th>File type</th>
                <td>{{pe.filetype}}</td>
            </tr>
            <tr>
                <th>MD5</th>
                <td>{{pe.md5}}</td>
            </tr>
            <tr>
                <th>SHA-1</th>
                <td>{{pe.sha_1}}</td>
            </tr>
            <tr>
                <th>SHA-256</th>
                <td>{{pe.sha_256}}</td>
            </tr>
            <tr>
                <th>Imphash</th>
                <td>{{pe.imphash}}</td>
            </tr>
            <tr>
                <th>SSDEEP</th>
                <td>{{pe.ssdeep}}</td>
            </tr>
        </table>

    </div>
</div>
<br>
<div id="Header" style="padding: 10px">
    <div class="header">
        <h3 align="left">Portable Executable Info</h3>
    </div>
    <div class="detail">

        <table height=140px width=770px style="margin-left: 20px; margin-top: 10px;">
            <div style="margin-left: 10px; margin-top: 15px;">
                <h4>Header</h4>
            </div>
            <tr>
                <th>Target Machine</th>
                <td>{{pe.Targetmachine}}</td>
            </tr>
            <tr>
                <th>Compilation Time</th>
                <td>{{pe.timestamp}}</td>
            </tr>
            <tr>
                <th>Entry Point</th>
                <td>{{pe.EntryPoint}}</td>
            </tr>
            <tr>
                <th>Contained Sections</th>
                <td>{{pe.ContainedSections}}</td>
            </tr>
        </table>
    </div>
</div>

<div id="wrapper2" style="padding: 10px">
    <div class="detail">
        <table height=160px id="section_table" width=1000px style="margin-left: 20px;margin-top: 15px;">
            <thead>
            <div style="margin-top: 25px; margin-left: 10px;">
                <h4>Sections</h4>
            </div>
            <tr>
                <th>Name</th>
                <th>Virtual Address</th>
                <th>Virtual Size</th>
                <th>Raw Size</th>
                <th>Entropy</th>
                <th>MD5</th>
            </tr>
            </thead>
        </table>
        {% if p_dict %}
        <script>
            var pe_result = "{{p_dict}}";
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("section_table");

            var json_pe = JSON.parse(text_pe_res);

            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page() {
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var section in json_pe[fname]) {
                            //section 부분만 출력하기 위한 if문

                            var new_row = pe_t.insertRow(pe_t.rows.length);

                            var Name = new_row.insertCell(0);
                            var Virtual_add = new_row.insertCell(1);
                            var Virtual_size = new_row.insertCell(2);
                            var Raw_size = new_row.insertCell(3);
                            var Entropy = new_row.insertCell(4);
                            var md5 = new_row.insertCell(5);

                            Name.innerHTML = json_pe[fname][section]['section_name'];
                            Virtual_add.innerHTML = json_pe[fname][section]['virtual_address'];
                            Virtual_size.innerHTML = json_pe[fname][section]['virtual_size'];
                            Raw_size.innerHTML = json_pe[fname][section]['raw_size'];
                            Entropy.innerHTML = json_pe[fname][section]['entropy'];
                            md5.innerHTML = json_pe[fname][section]['hash_md5'];
                        }
                    }
                }
            }

            change_page();

        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div id="wrapper3" style="padding: 10px">
    <div class="detail">
        <div style="margin-top: 20px; margin-left: 10px;">
            <h4 top=50px>Rich Header</h4>
        </div>
        <table height=160px id="xor_key" width=300px style="margin-left: 20px;margin-top: 15px;">
            <thead>
            <tr>
                <th>Xor Key</th>
            </tr>
            </thead>
        </table>
        <table height=160px id="rich_header" width=200px style="margin-left: 20px;">
            <thead>
            <tr>
                <th>Compiler Name</th>
                <th>Count</th>
            </tr>
            </thead>
        </table>
        {% if p_rich_list %}
        <script>
            var pe_result = "{{p_rich_list}}";
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("rich_header");
            var x_t = document.getElementById('xor_key');

            var json_pe = JSON.parse(text_pe_res);

            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page() {
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var rich in json_pe[fname]) {
                            //section 부분만 출력하기 위한 if문
                            //document.write(rich);
                            if (rich == "xor key") {
                                var x = x_t.insertRow(x_t.rows.length);
                                var xor = x.insertCell(0);

                                xor.innerHTML = json_pe[fname][rich];
                            } else {
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                var comp_name = new_row.insertCell(0);
                                var count = new_row.insertCell(1);

                                comp_name.innerHTML = rich;
                                count.innerHTML = json_pe[fname][rich];
                            }

                        }
                    }
                }
            }

            change_page();

        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div id="pdb" style="padding: 10px">
    <div class="detail">
        <table height=140px width=770px style="margin-left:20px;margin-top: 10px;">
            <div style="margin-top: 20px; margin-left: 10px;">
                <h4 top=50px>PDB_information</h4>
            </div>
            <tr>
                <th>PDB_Name</th>
                <td>{{pe.pdbname}}</td>
            </tr>
            <tr>
                <th>PDB_GUID</th>
                <td>{{pe.pdbguid}}</td>
            </tr>
            <tr>
                <th>PDB_Age</th>
                <td>{{pe.pdbage}}</td>
            </tr>
            <tr>
                <th>PDB_Path</th>
                <td>{{pe.pdbpath}}</td>
            </tr>
        </table>
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="contained_resource_table" width=200px style="margin-left: 20px;margin-top: 10px;">
            <thead>
            <div style="margin-top: 20px; margin-left: 10px;">
                <h4 top=50px>Contained Resources By Type</h4>
            </div>
            <tr>
                <th>Resource Name</th>
                <th>Count</th>
            </tr>
            </thead>
        </table>
        {% if p_rsrc_cnt %}
        <script>
            var pe_result = "{{p_rsrc_cnt}}";

            //document.write(pe_result);

            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("contained_resource_table");

            var json_pe = JSON.parse(text_pe_res);
            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page() {
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    //document.write(fname)
                    if (fname == pe_filename) {
                        for (var rsrc in json_pe[fname]) {
                            //document.write(rsrc[0])
                            //resource 부분만 출력하기 위한 if문

                            var new_row = pe_t.insertRow(pe_t.rows.length);

                            var Resource_name = new_row.insertCell(0);
                            var Count = new_row.insertCell(1);

                            Resource_name.innerHTML = rsrc;
                            Count.innerHTML = json_pe[fname][rsrc];

                        }
                    }
                }
            }

            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="contained_resource_language_table" width=230px style="margin-left: 20px;margin-top: 10px;">
            <thead>
            <div style="margin-top: 20px;margin-left: 10px;">
                <h4 top=50px>Contained Resources By Language</h4>
            </div>
            <tr>
                <th>Resource Language</th>
                <th>Count</th>
            </tr>
            </thead>
        </table>
        {% if p_rsrc_lang %}
        <script>
            var pe_result = "{{p_rsrc_lang}}";
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("contained_resource_language_table");

            var json_pe = JSON.parse(text_pe_res);

            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page() {
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var rsrc in json_pe[fname]) {
                            //resource 부분만 출력하기 위한 if문
                            if (rsrc[0] != '_' && rsrc[0] != '.' && rsrc[0] != '$') {
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                var Resource_lang = new_row.insertCell(0);
                                var Count = new_row.insertCell(1);

                                Resource_lang.innerHTML = rsrc;
                                Count.innerHTML = json_pe[fname][rsrc];
                            }
                        }
                    }
                }
            }

            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="contained_resource_list_table" width=1000px style="margin-left: 20px;margin-top: 10px;">
            <thead>
            <div style="margin-top: 20px; margin-left: 10px;">
                <h4>Contained Resources</h4>
            </div>
            <tr>
                <th>SHA-256</th>
                <th>Type</th>
                <th>Language</th>
            </tr>
            </thead>
        </table>
        {% if p_rsrc %}
        <script>
            var pe_result = "{{p_rsrc}}";

            var text_pe_res = pe_result.replace(/&#39;/gi, '"').replace(/\t/gi, "\\t").replace(/\r/gi, "\\r").replace(/\n/gi, "\\n").replace(/nan/gi, '"nan"').replace(/None/gi, '"none"');
            //document.write(text_pe_res);
            var pe_t = document.getElementById("contained_resource_list_table");

            var json_pe = JSON.parse(text_pe_res);

            //document.write(json_pe);

            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page() {
                var pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    //document.write(fname);
                    if (fname == pe_filename) {
                        for (var rsrc in json_pe[fname]) {
                            //document.write(fname)
                            //resource 부분만 출력하기 위한 if문
                            //document.write(rsrc[0])
                            //document.write(json_pe[fname][rsrc]['&amp;Resource Type'])
                            var new_row = pe_t.insertRow(pe_t.rows.length);
                            var Resource_sha256 = new_row.insertCell(0);
                            var Resource_type = new_row.insertCell(1);
                            var Resource_Lang = new_row.insertCell(2);

                            Resource_sha256.innerHTML = json_pe[fname][rsrc]['sha-256'];
                            Resource_type.innerHTML = json_pe[fname][rsrc]['Resource Type'];
                            Resource_Lang.innerHTML = json_pe[fname][rsrc]['Resource Language'];
                        }
                    }
                }
            }

            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <div height=200px id="Import_dll_list_table" width=1000px style="margin-left:10px;">
            <div style="margin-top: 20px">
                <h4 top=50px>Imports</h4>
            </div>
        </div>

        {% if p_dll_list %}
        <script>
            var pe_result = "{{p_dll_list}}";
            //document.write(pe_result)
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var json_pe = JSON.parse(text_pe_res);

            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page() {
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var list in json_pe[fname]) {
                            //document.write(fname)
                            //resource 부분만 출력하기 위한 if문
                            //list = list.toLowerCase()
                            if (list.substr(list.length - 4, list.length - 1) == ".dll" || list.substr(list.length - 4, list.length - 1) == ".DLL") {
                                //var new_row = pe_t.insertRow(pe_t.rows.length);
                                //var imp = new_row.insertCell(0);

                                //h6 태그 생성
                                var details = document.createElement('details');
                                var dll = document.createElement('summary');
                                //태그에 넣을 문자열 생성
                                var d = document.createTextNode(list);
                                //태그에 문자열 삽입
                                dll.appendChild(d);
                                details.appendChild(dll);
                                //태그를 html에 삽입
                                for (var i in json_pe[fname][list]) {

                                    var new_li = document.createElement('p');
                                    var l = document.createTextNode(json_pe[fname][list][i]);
                                    //var nl = document.createTextNode(re);
                                    new_li.appendChild(l);
                                    //document.getElementById('Import_dll_list_table').appendChild(new_li);
                                    details.appendChild(new_li);
                                    //details.appendChild(nl);
                                }
                                document.getElementById('Import_dll_list_table').appendChild(details);

                            }
                        }
                    }
                }
            }

            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

{% endfor %}
</div>
<br><br><br>

{% endblock section %}

{% block foot %}
{% endblock foot %}