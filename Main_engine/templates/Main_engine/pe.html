{% extends "Main_engine/layout.html" %}

{% block head %}
{% load static %}
<link href="{% static 'Main_engine/css/pe.css' %}" rel="stylesheet">
<link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">
{% endblock %}

{% block section %}
<br><br><br>
<div id="wrapper" style="padding: 20px">
    <div class="header">
        <h3 align="left">Basic Properties</h3>
    </div>
    <div class="detail">
        {% for pe in lists %}
        <table height=300px width=1500px>
            <tr>
                <th>File name</th>
                <td>{{pe.filename}}</td>
            </tr>
            <tr>
                <th>File size</th>
                <td>{{pe.filesize}}</td>
            </tr>
            <tr>
                <th>File type</th>
                <td>{{pe.filetype}}</td>
            </tr>
            <tr>
                <th>MD5</th>
                <td>{{pe.md5}}</td>
            </tr>
            <tr>
                <th>SHA-1</th>
                <td>{{pe.sha_1}}</td>
            </tr>
            <tr>
                <th>SHA-256</th>
                <td>{{pe.sha_256}}</td>
            </tr>
            <tr>
                <th>Imphash</th>
                <td>{{pe.imphash}}</td>
            </tr>
            <tr>
                <th>SSDEEP</th>
                <td>{{pe.ssdeep}}</td>
            </tr>
        </table>

    </div>
</div>

<div id="Header" style="padding: 10px">
    <div class="header">
        <h3 align="left">Portable Executable Info</h3>
    </div>
    <div class="detail">

        <table height=140px width=770px>
            <div>
                <h4 top=50px>Header</h4>
            </div>
            <tr>
                <th>Target Machine</th>
                <td>{{pe.Targetmachine}}</td>
            </tr>
            <tr>
                <th>Compilation Time</th>
                <td>{{pe.timestamp}}</td>
            </tr>
            <tr>
                <th>Entry Point</th>
                <td>{{pe.EntryPoint}}</td>
            </tr>
            <tr>
                <th>Contained Sections</th>
                <td>{{pe.ContainedSections}}</td>
            </tr>
        </table>
    </div>
</div>

<div id="wrapper2" style="padding: 10px">
    <div class="detail">
        <table height=160px id="section_table" width=1000px>
            <thead>
            <div style="margin-top: 20px">
                <h4 top=50px>Sections</h4>
            </div>
            <tr>
                <th>Name</th>
                <th>Virtual Address</th>
                <th>Virtual Size</th>
                <th>Raw Size</th>
                <th>Entropy</th>
                <th>MD5</th>
            </tr>
            </thead>
        </table>
        {% if p_dict %}
        <script>
            var pe_result = "{{p_dict}}";
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("section_table");

            var json_pe = JSON.parse(text_pe_res);
            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page(){
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var section in json_pe[fname]) {
                            //section 부분만 출력하기 위한 if문
                            if(section[0] == '.'){
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                var Name = new_row.insertCell(0);
                                var Virtual_add = new_row.insertCell(1);
                                var Virtual_size = new_row.insertCell(2);
                                var Raw_size = new_row.insertCell(3);
                                var Entropy = new_row.insertCell(4);
                                var md5 = new_row.insertCell(5);

                                Name.innerHTML = json_pe[fname][section]['section_name'];
                                Virtual_add.innerHTML = json_pe[fname][section]['virtual_address'];
                                Virtual_size.innerHTML = json_pe[fname][section]['virtual_size'];
                                Raw_size.innerHTML = json_pe[fname][section]['raw_size'];
                                Entropy.innerHTML = json_pe[fname][section]['entropy'];
                                md5.innerHTML = json_pe[fname][section]['hash_md5'];
                            }
                        }
                    }
                }
            }
            change_page();

        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div id="pdb" style="padding: 10px">
    <div class="detail">
        <table height=140px width=770px>
            <div style="margin-top: 20px">
                <h4 top=50px>PDB_information</h4>
            </div>
            <tr>
                <th>PDB_Name</th>
                <td>{{pe.pdbname}}</td>
            </tr>
            <tr>
                <th>PDB_GUID</th>
                <td>{{pe.pdbguid}}</td>
            </tr>
            <tr>
                <th>PDB_Age</th>
                <td>{{pe.pdbage}}</td>
            </tr>
            <tr>
                <th>PDB_Path</th>
                <td>{{pe.pdbpath}}</td>
            </tr>
        </table>
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="contained_resource_table" width=200px>
            <thead>
            <div style="margin-top: 20px">
                <h4 top=50px>Contained Resources By Type</h4>
            </div>
            <tr>
                <th>Resource Name</th>
                <th>Count</th>
            </tr>
            </thead>
        </table>
        {% if p_dict %}
        <script>
            var pe_result = "{{p_dict}}";
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("contained_resource_table");

            var json_pe = JSON.parse(text_pe_res);
            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page(){
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var rsrc in json_pe[fname]) {
                            //document.write(rsrc[0])
                            //resource 부분만 출력하기 위한 if문
                            if(rsrc[0] == '_'){
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                var Resource_name = new_row.insertCell(0);
                                var Count = new_row.insertCell(1);

                                Resource_name.innerHTML = rsrc.substr(1, rsrc.length - 1);
                                Count.innerHTML = json_pe[fname][rsrc];
                            }
                        }
                    }
                }
            }
            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="contained_resource_language_table" width=230px>
            <thead>
            <div style="margin-top: 20px">
                <h4 top=50px>Contained Resources By Language</h4>
            </div>
            <tr>
                <th>Resource Language</th>
                <th>Count</th>
            </tr>
            </thead>
        </table>
        {% if p_dict %}
        <script>
            var pe_result = "{{p_dict}}";
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("contained_resource_language_table");

            var json_pe = JSON.parse(text_pe_res);
            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page(){
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var rsrc in json_pe[fname]) {
                            //resource 부분만 출력하기 위한 if문
                            if(rsrc[0] != '_' && rsrc[0] != '.' && rsrc[0] != '$'){
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                var Resource_lang = new_row.insertCell(0);
                                var Count = new_row.insertCell(1);

                                Resource_lang.innerHTML = rsrc;
                                Count.innerHTML = json_pe[fname][rsrc];
                            }
                        }
                    }
                }
            }
            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="contained_resource_list_table" width=1000px>
            <thead>
            <div style="margin-top: 20px">
                <h4 top=50px>Contained Resources</h4>
            </div>
            <tr>
                <th>SHA-256</th>
                <th>Type</th>
                <th>Language</th>
            </tr>
            </thead>
        </table>
        {% if p_dict %}
        <script>
            var pe_result = "{{p_dict}}";
            //document.write(pe_result)
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("contained_resource_list_table");

            var json_pe = JSON.parse(text_pe_res);
            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page(){
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var rsrc in json_pe[fname]) {
                            //document.write(fname)
                            //resource 부분만 출력하기 위한 if문
                            if(rsrc[0] == '$'){
                                //document.write(rsrc[0])
                                //document.write(json_pe[fname][rsrc]['&amp;Resource Type'])
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                var Resource_sha256 = new_row.insertCell(0);
                                var Resource_type = new_row.insertCell(1);
                                var Resource_Lang = new_row.insertCell(2);

                                sha = '&amp;sha-256'
                                type = '&amp;Resource Type'
                                lang = '&amp;Resource Language'

                                Resource_sha256.innerHTML = json_pe[fname][rsrc][sha];
                                Resource_type.innerHTML = json_pe[fname][rsrc][type].substr(1, json_pe[fname][rsrc][type].length - 1);
                                Resource_Lang.innerHTML = json_pe[fname][rsrc][lang];
                            }
                        }
                    }
                }
            }
            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

<div style="padding: 10px">
    <div class="detail">
        <table height=160px id="Import_dll_list_table" width=1000px>
            <thead>
            <div style="margin-top: 20px">
            <h4 top=50px>Imports</h4>
        </div>
            <tr>
                <th>imports</th>
            </tr>
            <lu id="dll_list">

            </lu>
            </thead>
        </table>

        {% if p_dll_list %}
        <script>
            var pe_result = "{{p_dll_list}}";
            //document.write(pe_result)
            /*
            document.write(pe_result);
            */
            var text_pe_res = pe_result.replace(/&#39;/gi, '"');
            var pe_t = document.getElementById("Import_dll_list_table");

            var json_pe = JSON.parse(text_pe_res);
            /* 파일 이름이 다르면 테이블이 변경됨 */

            function change_page(){
                pe_filename = "{{pe.filename}}";
                for (var fname in json_pe) {
                    if (fname == pe_filename) {
                        for (var list in json_pe[fname]) {
                            //document.write(fname)
                            //resource 부분만 출력하기 위한 if문
                            //list = list.toLowerCase()
                            if(list.substr(list.length - 4, list.length - 1) == ".dll" || list.substr(list.length - 4, list.length - 1) == ".DLL"){
                                var new_row = pe_t.insertRow(pe_t.rows.length);

                                //var imp = new_row.insertCell(0);
                                //var li = new_row.insertCell(1);

                                //imp.innerHTML = list
                                //li.innerHTML = json_pe[fname][list];
                                document.write(list);
                                document.write(json_pe[fname][list].length);
                                for (var i in json_pe[fname][list]) {
                                    //var l = document.createElement('div');
                                    //l.createTextNode('test');

                                    //document.getElementById('dll_list').appendChild(l);
                                    document.write(json_pe[fname][list][i]);
                                }

                            }
                        }
                    }
                }
            }
            change_page();
        </script>
        {% else %}
        <h1>no result</h1>
        {% endif %}
    </div>
</div>

{% endfor %}
</div>

{% endblock section %}

{% block foot %}
{% if lists.has_other_pages %}
<nav aria-label="...">
    <div id="page" style="position: relative; left: 600px; top: 20px;">
        <ul class="pagination">
            {% if lists.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ lists.previous_page_number }}">Previous</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link">Previous</span>
            </li>
            {% endif %}
            {% for i in lists.paginator.page_range %}
            {% if lists.number == i %}
            <li aria-current="page" class="page-item active">
                <span class="page-link">{{ i }}<span class="sr-only">(current)</span></span></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
            {% endif %}
            {% endfor %}
            {% if lists.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ lists.next_page_number }}">Next</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <a class="page-link">Next</a>
            </li>
            {% endif %}
        </ul>
    </div>
</nav>
{% endif %}
{% endblock foot %}